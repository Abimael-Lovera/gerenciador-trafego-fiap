name: CI - Feature

on:
  push:
    branches:
      - "feature**"

permissions: write-all

jobs:
  build-and-pr:
    name: Build and PR
    runs-on: ubuntu-latest
  
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'corretto'
          cache: 'maven'
      
      - name: Build
        run: mvn clean package -DskipTests
      
      - name: List build artifacts
        run: ls -lrt target
      
      - name: Upload build artifacts
        id: upload-artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-jar
          path: target/*.jar
      
      - name: pull-request
        uses: repo-sync/pull-request@v2
        with:
          destination_branch: "develop"
          github_token: ${{ secrets.GITHUB_TOKEN }}
          pr_label: "feature, automated pr"
          pr_title: "[Feature] Merge para develop de ${{ github.ref_name }}"
          pr_body: |
            ## PR Autom√°tico
            
            Este PR foi criado automaticamente pelo workflow de CI.
            Branch de origem: `${{ github.ref_name }}`
